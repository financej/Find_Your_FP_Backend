trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- task: Gradle@2
  inputs:
    workingDirectory: 'backend'
    gradleWrapperFile: 'backend/gradlew'
    gradleOptions: '-Xmx3072m'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: 'default'
    jdkArchitectureOption: 'x64'
    publishJUnitResults: true
    testResultsFiles: '**/TEST-*.xml'
    tasks: 'build'

# Assuming build produces a .jar file in the build/libs directory, adjust path as needed.
- task: CopyFiles@2
  inputs:
    SourceFolder: '$(System.DefaultWorkingDirectory)'
    Contents: '**/build/libs/*.jar'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'

# Publish the artifact to Azure Pipelines.
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'

# Deploy the .jar file to Azure App Service
- task: AzureWebApp@1
  inputs:
    azureSubscription: 'metlife-it-hackathon'
    appType: 'webAppLinux'
    appName: 'app-metlife-team09'
    package: '$(Build.ArtifactStagingDirectory)/**/*.jar'
    runtimeStack: 'JAVA|17-java11' # Adjust the Java version according to your app's requirements
